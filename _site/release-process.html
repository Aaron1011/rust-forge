<!DOCTYPE html>
<!-- Page last generated 2016-01-22 01:47:08 +0000 -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>The Rust Release Process &middot; The Rust Programming Language</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Rust, Rust programming language, rustlang, rust-lang, Mozilla Rust">
    <meta name="description" content="A systems programming language that runs blazingly fast, prevents segfaults, and guarantees thread safety.">
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/rust-forge/css/bootstrap.css">
    <link rel="stylesheet" href="/rust-forge/css/style.css">
  </head>

  <body class="container">

    <header>

    <ul class="row menu">
      <li class="col-xs-12 col-md-2">
        <a href="index.html">
          <img class="img-responsive" src="logos/rust-logo-256x256-blk.png" height="128" width="128" alt="Rust logo" />
        </a>
      </li>
      <li class="col-xs-12 col-md-10 menu">
	<h2>Rust: Forged from Blood and Iron in the Fires of Hell</h2>
      </li>
    </ul>
    </header>

    <div class="content"><h1>The Rust Release Process</h1>

<p>The Rust release process is mostly in my head right now, so I took notes on how it went this time (1.3.0).</p>

<h2>Channel promotion and new beta/stable builds (T-2 days)</h2>

<p>Tag a new Cargo release that will be included with the new beta build (same tagging instructions as for Rust below). Then edit the <code>cargo-revs.txt</code> file <a href="https://github.com/rust-lang/rust-packaging">in rust-packaging</a> to update the Cargo version for the beta you&#39;re about to build.</p>

<p>Promote beta to stable, then nightly to beta as follows.
This is local, in your Rust repo, assuming you have push access to rust-lang. </p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="gp">$ </span>git fetch rust-lang
<span class="gp">$ </span>git push rust-lang rust-lang/beta:stable -f
<span class="gp">$ </span>git push rust-lang rust-lang/master:beta -f
</code></pre></div>
<p>Manually start the <code>beta-dist-rustc-trigger</code> and <code>stable-dist-rustc-trigger</code> builds on buildbot.rust-lang.org.
You&#39;ve got around 48 hours to ensure that both these succeed.</p>

<p>The beta will deploy automatically, the stable not. Precisely, the stable build will upload docs to
the s3 bin under <code>doc/$version</code>, but <em>not</em> <code>doc/stable</code>, and will not upload the bins anywhere,
instead leaving them staged in the <code>tmp/dist/packaging-stable/final</code> subdirectory of the buildbot master.</p>

<p>Make and submit a patch against master that bumps the version number in <code>mk/main.mk</code>.</p>

<h2>Prerelease testing (T-1 day)</h2>

<p>Write a new blog post and update rust-www. Submit PRs for tomorrow.</p>

<p>Now upload the bins to an s3 staging directory for testing as follows.
This happens on the buildmaster under the rustbuild user.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nb">cd</span> ~/rust-buildbot/master/tmp/dist/packaging-stable
<span class="c"># Move final staged bins to another directory. This clears out 'final' for the next release.</span>
mv final final-1.3.0
<span class="c"># Upload final to s3 staging for testing</span>
s3cmd del s3://static-rust-lang-org/dist/staging/ --recursive
s3cmd put -P ./final-1.3.0/<span class="k">*</span> s3://static-rust-lang-org/dist/staging/dist/
</code></pre></div>
<p>Regenerate the index.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="o">(</span><span class="nb">cd</span> <span class="o">&amp;&amp;</span> sh update-rust-dist-index.sh<span class="o">)</span>
</code></pre></div>
<p>Post a message to irlo asking for testing. The index is http://static-rust-lang-org.s3.amazonaws.com/dist/staging/dist/index.html</p>

<p>Test multirust with</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">RUSTUP_DIST_SERVER</span><span class="o">=</span>https://static.rust-lang.org/dist/staging multirust update stable
</code></pre></div>
<h2>Release day</h2>

<p>This is on the buildmaster again.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nb">cd</span> ~/rust-buildbot/master/tmp/dist/packaging-stable
<span class="c"># Sync docs from s3 versioned dir to local</span>
mkdir ./doc-1.3.0
s3cmd sync -P s3://static-rust-lang-org/doc/1.3.0/ ./doc-1.3.0/
<span class="c"># Sync bins to s3 archives</span>
s3cmd put -P ./final-1.3.0/<span class="k">*</span> s3://static-rust-lang-org/dist/2015-09-17/
<span class="c"># Sync docs to s3 stable/</span>
<span class="c"># Do this in a screen session in case you lose network access to AWS!</span>
s3cmd sync -P ./doc-1.3.0/ s3://static-rust-lang-org/doc/stable/
<span class="c"># Sync bins to release channel</span>
<span class="c"># Do this in a screen session in case you lose network access to AWS!</span>
s3cmd put -P ./final-1.3.0/<span class="k">*</span> s3://static-rust-lang-org/dist/
<span class="c"># Invalidate the CDN</span>
sh ~/invalidate.sh
</code></pre></div>
<p>Next merge the website. It takes a while to deploy.</p>

<p>Merge blog post.</p>

<p>Locally, tag the new release and upload it. Use &quot;x.y.z release&quot; as the commit message.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="gp">$ </span>git tag -u FA1BE5FE 1.3.0 <span class="nv">$COMMIT_SHA</span>
<span class="gp">$ </span>git push rust-lang 1.3.0
</code></pre></div>
<p>Run <code>cargo publish</code> for the Cargo tag created in the first step.</p>

<p>Bask in your success.</p>
</div>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-58390457-1', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>
